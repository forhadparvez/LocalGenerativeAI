@{
    ViewData["Title"] = "AI Chat";
}

<div class="container mt-4">
    <h2>Local AI Assistant</h2>

    <div id="chatBox" class="border rounded p-3 mb-3"
         style="height:400px; overflow-y:auto; background:#f8f9fa;">
    </div>

    <div class="input-group">
        <input type="text" id="userInput" class="form-control"
               placeholder="Type your message..." />
        <button class="btn btn-primary" id="sendBtn">Send</button>
    </div>
</div>

@section Styles {

}

@section Scripts {
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $("#sendBtn").click(function () {

        var message = $("#userInput").val();

        if (!message) return;

        // Add user message to chat
        $("#chatBox").append(
            "<div class='text-end mb-2'>" +
            "<div class='p-2 rounded bg-secondary text-white user-bubble'>" +
            message +
            "</div></div>"
        );

        $("#userInput").val("");

        $.ajax({
            url: "http://localhost:8000/chat",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ message: message }),
            success: function (res) {

                if (res.response) {

                    $("#chatBox").append(
                        "<div class='text-start mb-2'>" +
                        "<div class='p-2 rounded bg-light border ai-bubble'>" +
                        res.response +
                        "</div></div>"
                    );

                    $("#chatBox").scrollTop($("#chatBox")[0].scrollHeight);
                }
                else {
                    alert("AI Error");
                }
            }
        });
    });
</script>
}
